考虑 min-plus 矩阵的转置原理，设询问的答案为 $ans_1,ans_2,\cdots,ans_q$，令矩阵

$$
M=\begin{pmatrix}ans_1\\ans_2\\\vdots\\ans_q\end{pmatrix}
$$

所求即为 $M\cdot\begin{pmatrix}0\end{pmatrix}$。转置后变为计算

$$
\begin{aligned}
&~~~~~M^T\cdot\begin{pmatrix}w_1\\w_2\\\vdots\\w_q\end{pmatrix}\\
&=\min(ans_1+w_1,\cdots,ans_q+w_q)
\end{aligned}
$$

设 $a_{t,i}$ 表示 $t$ 次操作后 $a_i$ 的值，则上式为

$$
\begin{aligned}
&~~~~~\min_{1\le k\le q}\left(\left(\min_{0\le i\le t_k}\max_{1\le j\le x_k}a_{i,j}\right)+w_k\right)\\
&=\min_{0\le i\le m}\left(\min_{1\le x\le n}\left(\min_{k~:~i\le t_k,x_k=x}w_k+\max_{1\le j\le x}a_{i,j}\right)\right)
\end{aligned}
$$

按 $i$ 从 $m$ 到 $0$ 扫描，记 $y_x=\min\limits_{k~:~i\le t_k,x_k=x}w_k$，查询的式子为 $\min\limits_{1\le x\le n}\left(y_x+\max\limits_{1\le j\le x}a_{i,j}\right)$，即序列 $a_{i,*}$ 的前缀最大值的每项加上 $y_*$ 后的最小值。需要支持的操作为对 $a$ 区间加，以及对 $y$ 单点修改。可以使用单侧递归的线段树（或被称为“楼房重建”）来实现，时间复杂度为 $\mathcal O\left((n+m)\log^2n\right)$。将该算法转置后可以在线地处理所有操作。
