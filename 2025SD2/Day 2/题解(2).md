考虑容斥，将 $0\sim k$ 必须出现转化为钦定某些数不能出现。设 $f_{i,j}$ 表示 $0\sim i$ 必须出现，现在钦定其中 $j$ 个数不能出现，所有 $B_k\le i$ 的 $A_k$ 的方案数乘容斥系数之和。

转移时，先令 $f_{i,j}\gets f_{i-1,j}-f_{i-1,j-1}$。若有 $C$ 个 $k$ 满足 $B_k=i$，则再令 $f_{i,j}\gets f_{i,j}\times (i+1-j)^C$。

设 $g_{i,j}$ 表示 $MEX(A)\le i$，且钦定 $0\sim i$ 中有 $j$ 个数不能出现，所有 $B_k\le i$ 的 $A_k$ 的 $MEX(A)$ 乘容斥系数之和。

转移时，先令 $g_{i,j}\gets i\times f_{i-1,j-1}+g_{i-1,j}$。若有 $C$ 个 $k$ 满足 $B_k=i$，则再令 $g_{i,j}\gets g_{i,j}\times (i+1-j)^C$。

注意到 $MEX(A)$ 一定不超过 $n$，因此两个 dp 数组只需计算到第 $n$ 行，其余数的贡献容易计算。时间复杂度为 $\mathcal O(n^2)$。
